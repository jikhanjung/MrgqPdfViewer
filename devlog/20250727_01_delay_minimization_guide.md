# 실시간 악보 넘김 시스템의 딜레이 최소화 전략

"블루투스 페달 → 지휘자 기기 → 연주자 기기" 구조에서 신호 전달 지연을 줄이기 위한 최적화 방법을 각 단계별로 정리한 문서입니다.

---

## 🔹 1. 블루투스 페달 → 지휘자 기기

### ✅ 사용 프로토콜 선택
- **Bluetooth HID** 방식은 입력 속도가 빠름 (키보드와 유사).
- **BLE**는 저전력이지만 딜레이가 생길 수 있음.
- ➤ **HID 방식 유지** 권장.

### ✅ 블루투스 연결 최적화
- 페어링 후 연결 유지: 절전 진입 방지.
- 지휘자 기기와 페달 간 거리 최소화.
- Wi-Fi 2.4GHz 간섭 피하기 (가능하면 5GHz 사용).

### ✅ OS 레벨 설정
- Android에서는 `KeyEvent` 처리 우선순위 조정.
- 앱에 **백그라운드 실행 권한** 부여하여 절전 차단.

---

## 🔹 2. 지휘자 기기 → 연주자 기기

### ✅ 통신 방식
- **WebSocket**: 실시간 양방향 통신에 적합.
- **UDP**: 더 빠르지만 재전송 불가 → 신뢰성 낮음.
- ➤ 실시간 반응이 중요하므로 WebSocket 권장.

### ✅ Wi-Fi 네트워크 구성
- **로컬 Wi-Fi 핫스팟**: 지휘자 기기에서 직접 생성.
- 또는 **5GHz 공유기 사용**, ping latency 5ms 이하 유지.

### ✅ 메시지 구조 최적화
- 메시지를 가능한 한 짧게: 예) `{ "cmd": "next" }` 또는 `b'n'`.

### ✅ 코드 최적화
- 메시지 수신 후 **즉시 처리**: UI thread를 block하지 않도록 주의.
- **이벤트 루프 최적화**, 필요 시 별도 thread에서 처리.

---

## 🔹 전체 요약

| 구간 | 권장 사항 |
|------|-----------|
| 블루투스 페달 → 지휘자 | HID 방식 유지, 연결 유지, 절전 해제 |
| 지휘자 → 연주자 | WebSocket 사용, 5GHz Wi-Fi 직결, 메시지 최소화 |
| 앱 구현 측면 | 메시지 처리 코드의 반응성 유지, UI Thread 블로킹 방지 |

---

## 🔧 부가 팁

- `ping` 측정 도구나 Android Logcat을 통해 실측 분석 가능.
- 목표 반응 속도: **0.1초 이내** (100ms 이하).
