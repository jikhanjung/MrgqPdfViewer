# 1. 비전 및 로드맵

## 1.1 프로젝트 개요

MrgqPdfViewer는 Android TV용 PDF 악보 뷰어 애플리케이션입니다. 혁신적인 UI와 리모컨에 최적화된 직관적인 탐색 기능을 제공합니다. 핵심 기능은 여러 기기 간에 페이지를 동기화할 수 있는 **실시간 합주 모드**입니다.

### 핵심 목표:
Android TV OS를 위한 전용 PDF 악보 리더를 제공하여, 직관적인 제어와 실시간 동기화 기능을 통해 음악가들의 경험을 향상시키는 것입니다.

## 1.2 핵심 요구사항

이 애플리케이션은 다음 핵심 요구사항을 충족하는 것을 목표로 합니다:

*   **PDF 보기:** PDF 파일의 고해상도 렌더링을 지원하며, 단일 페이지 및 두 페이지 표시 모드를 제공합니다.
*   **파일 관리:** TV에서 PDF 파일을 효율적으로 탐색하고, 정렬(이름/시간순) 및 삭제할 수 있습니다.
*   **무선 업로드:** 브라우저를 통해 PDF 파일을 TV로 무선으로 업로드할 수 있는 간단한 웹 기반 시스템을 제공합니다.
*   **합주 모드 (실시간 협업):**
    *   **지휘자 역할:** 다른 기기들의 페이지 넘김 및 파일 변경을 제어하는 마스터 역할을 하는 기기입니다.
    *   **연주자 역할:** 지휘자의 동작에 따라 자동으로 뷰를 동기화하는 기기입니다.
    *   **자동 발견:** UDP 브로드캐스트를 사용하여 로컬 네트워크에서 지휘자 기기를 자동으로 감지합니다.
    *   **안정적인 연결:** 포트 충돌을 방지하고 빠른 재연결을 보장하도록 설계된 실시간 동기화를 위한 견고한 WebSocket 통신을 사용합니다.
    *   **파일 공유:** 지휘자가 현재 PDF 파일을 연주자들과 공유할 수 있으며, 누락된 파일에 대한 다운로드 제안 기능도 포함합니다.
*   **TV 최적화:** Android TV 및 리모컨 상호작용에 특화된 사용자 인터페이스 및 탐색 기능을 제공합니다.

## 1.3 MrgqPdfViewer 기능 로드맵

이 로드맵은 MrgqPdfViewer의 단기적인 개발 방향을 제시합니다.

### 단기 목표 (v0.1.x - 현재 중점)

*   **"마지막 읽은 페이지" 기능 구현:** 각 PDF의 마지막으로 본 페이지를 기억하고, 파일을 다시 열 때 자동으로 해당 페이지로 이동합니다. (최우선 순위)
*   **두 페이지 모드 개선:** 오른쪽에서 왼쪽으로 페이지 순서와 같이 두 페이지 모드에 대한 사용자 구성 가능한 옵션을 추가합니다. (최우선 순위)
*   **UI/UX 향상:** TV 화면에서의 시각적 매력과 사용성을 개선하기 위해 UI를 다듬습니다. (최우선 순위)
*   **악보 메타데이터 활용:** 작곡가, 제목, 장르를 기반으로 정렬 및 검색 기능을 구현합니다.
*   **북마크 시스템:** 사용자가 PDF 내의 특정 페이지를 북마크할 수 있도록 합니다.
*   **데이터베이스 마이그레이션 도구:** 기존 설정을 자동으로 마이그레이션하는 도구를 제공합니다.

## 1.4 개선 보고서

프로젝트는 특히 합주 모드와 전반적인 안정성 측면에서 상당한 개선을 이루었습니다.

### 달성된 주요 개선 사항:

*   **합주 모드 아키텍처 재구조화:**
    *   **100% 연결 성공률:** 근본적인 콜백 생명주기 타이밍 문제를 해결했습니다.
    *   **일관된 모드 활성화:** 모드 활성화(활성화 -> 콜백 설정 -> 작동)를 위한 표준화된 흐름을 보장했습니다.
    *   **향상된 콜백 관리:** 포괄적인 콜백 체인 추적을 위해 `🎯` 접두사 로깅을 구현했습니다.
    *   **UDP 포트 관리:** 견고한 소켓 정리 및 즉각적인 재사용을 통해 포트 충돌을 0%로 만들었습니다.
*   **TV 사용자 경험 혁신:**
    *   **TV 스타일 설정 화면:** 카테고리별 메뉴 구조(파일 관리, 웹 서버, 합주 모드, 시스템, 정보)를 도입했습니다.
    *   **리모컨 최적화:** 72dp 최소 터치 영역과 직관적인 DPAD 탐색을 보장했습니다.
*   **합주 모드 안정성:**
    *   **포트 바인딩 문제 해결:** 1초 소켓 타임아웃 및 반응형 Accept 스레드를 구현했습니다.
    *   **전역 파일 변경 처리:** 모든 화면이 지휘자의 파일 변경에 반응하도록 보장했으며, 자동 화면 전환 기능도 포함했습니다.
    *   **파일 다운로드 통합:** 연주자를 위한 다운로드 경험을 간소화했습니다.
*   **성능 지표:**
    *   **연결 성공률:** 30%에서 **100%**로 향상되었습니다.
    *   **포트 충돌:** 제거되었습니다 (0% 충돌률).
    *   **사용자 경험:** 원클릭 합주 모드 시작, 실시간 피드백, 직관적인 TV 설정

### 기술 혁신:

*   **생명주기 기반 아키텍처:** 콜백 정리, 모드 활성화, 콜백 설정, 작동 시작의 명확한 순서를 보장했습니다.
*   **방어적 프로그래밍:** 모든 콜백에 대한 null 검사 및 상태 검증을 구현했습니다.
*   **추적 가능한 디버깅:** 로그를 통해 전체 콜백 체인 추적을 가능하게 했습니다.
*   **리소스 관리:** 강제 종료, 재시도 및 검증을 통해 100% 포트 해제를 보장했습니다.

### Flutter 포팅 분석 (요약)

Flutter로 애플리케이션을 포팅하는 것에 대한 분석이 수행되었습니다. Flutter는 크로스 플랫폼 이점을 제공하지만, 현재 프로젝트의 Android 특정 API(예: `PdfRenderer`, `NanoHTTPD`, TV 리모컨용 `KeyEvent`)와의 깊은 통합과 Kotlin/Android TV 개발에 대한 기존 투자를 고려할 때, 전체 포팅은 현재 범위에서 제한적인 즉각적인 이점을 가진 상당한 작업입니다. Flutter에 대한 향후 고려는 더 광범위한 멀티 플랫폼 전략에 따라 달라질 것입니다.

## 1.5 ScoreMate 프로젝트 비전

MrgqPdfViewer는 로컬 네트워크 기반의 PDF 악보 뷰어로서 견고한 기반을 다졌습니다. 다음 단계는 **ScoreMate**라는 이름으로, 클라우드 기반의 멀티플랫폼 악보 관리 및 동기화 솔루션으로 발전하는 것입니다.

ScoreMate는 MrgqPdfViewer의 핵심 PDF 뷰어 및 합주 동기화 기능을 계승하면서, 다음과 같은 새로운 차원의 기능을 제공할 것입니다.

*   **서버 동기화:** 사용자의 악보 라이브러리를 클라우드 서버와 동기화하여, 어떤 기기에서든 자신의 악보에 접근하고 관리할 수 있도록 합니다.
*   **PDF 라이브러리 관리:** 클라우드 기반의 체계적인 악보 라이브러리 관리 시스템을 제공하여, 악보 검색, 분류, 메타데이터 편집 등을 용이하게 합니다.
*   **멀티플랫폼 지원:** Android TV뿐만 아니라, 모바일(Android/iOS), 데스크톱(Windows/macOS) 등 다양한 플랫폼에서 ScoreMate를 사용할 수 있도록 확장합니다.

ScoreMate는 MrgqPdfViewer에서 얻은 경험과 기술적 성과를 바탕으로, 음악가들이 악보를 관리하고 공유하며 합주하는 방식을 혁신할 것입니다.
