# ScoreMate 통신 보안 전략 개요

ScoreMate는 로컬 네트워크 기반의 합주 앱으로서, 지휘자와 연주자 간의 실시간 통신과 PDF 악보의 파일 업로드 기능을 포함합니다. 이 문서는 ScoreMate에서 필요한 **통신 보안 전략**을 정리한 것으로, 다음의 두 주요 시나리오를 중심으로 설명합니다:

- **합주 모드에서의 안전한 통신 구조**
- **웹브라우저를 이용한 파일 업로드 시의 보안 문제와 대안**

---

## 1. 합주 모드: 지휘자-연주자 간 안전한 실시간 통신

### 🔐 목표
지휘자(서버 역할을 하는 앱)와 연주자(클라이언트 역할을 하는 앱)가 **로컬 네트워크 상에서 WSS (WebSocket over TLS)를 이용해 안전하게 통신**할 수 있도록 구성합니다.

### ✅ 해결책: self-signed 인증서 기반 통신
- 앱에는 동일한 **self-signed 인증서 (`keystore.bks`)와 공개키 (`mycert.crt`)**를 내장합니다.
- 지휘자 역할의 장비는 HTTPS 및 WSS 서버를 구동하며 인증서를 이용해 TLS 세션을 생성합니다.
- 연주자 앱은 해당 인증서를 `network_security_config.xml`을 통해 신뢰하도록 구성되어 WSS 접속 시 보안 경고 없이 연결이 가능합니다.

### ⚙ 구성 흐름
```
[연주자 앱] --wss://192.168.x.x:port--> [지휘자 앱]
          🔐 self-signed 인증서 신뢰 설정 포함
```

### ✅ 장점
- 로컬 환경에서도 안전한 암호화 통신 가능
- 인터넷 연결 불필요
- 한 앱이 지휘자/연주자 역할을 자유롭게 선택 가능

---

## 2. 로컬 네트워크 브라우저 업로드: self-signed 인증서 사용 시 문제점

### 🎯 목적
사용자가 **PC 브라우저에서 앱이 띄운 웹서버에 접속해 PDF 파일을 업로드**하는 구조

### ⚠ 문제: self-signed 인증서 + 브라우저 경고
- 앱이 NanoHTTPD 등으로 HTTPS 서버를 띄우고 self-signed 인증서를 사용할 경우,
- 브라우저에서 `https://192.168.x.x:포트` 접속 시 **보안 경고가 발생**합니다.
- 사용자가 “고급 → 계속”을 눌러야만 접근 가능

### 🔓 보안 리스크
- 사용자가 반복적으로 self-signed 인증서를 **무비판적으로 신뢰하는 습관**을 가지게 됨
- 장기적으로 피싱, MITM 등 보안 공격에 취약해지는 사용자 행동 패턴 유발

### ❌ FTP 사용의 대안성
- FileManager+ 앱 등의 FTP 기반 파일 전송도 마찬가지로 **암호화되지 않음**
- FTP는 기본적으로 평문이며, 로그인 정보 및 파일 내용이 모두 노출 가능
- ✅ HTTPS 기반 업로드만이 실질적인 보안 대책이 됨

---

## 3. 최종 구조: 외부 서버 기반 업로드 및 동기화

### ✅ 구조 개요
브라우저에서 파일을 로컬 장비로 직접 전송하지 않고, **공식 도메인(`sync.scoremate.ai`)에 업로드** → 앱은 그 서버와 **HTTPS 기반 동기화**를 통해 파일을 가져오는 구조

### 🔐 장점
- 브라우저는 **공인 인증서 기반의 HTTPS 서버에만 접속** → 경고 없음
- 파일 전송은 항상 암호화되어 안전하게 수행됨
- 앱은 Supabase 또는 Next.js 서버의 API를 통해 로그인 후 파일 목록 동기화 및 다운로드

### 📡 구성 흐름
```
[PC 브라우저] --HTTPS--> [sync.scoremate.ai] ← 앱이 정기적으로 파일 동기화
                                             ↳ Supabase 스토리지에 PDF 보관
```

### 🚫 단점
- 인터넷 연결이 필요
- 앱이 파일을 직접 받는 구조보다 상대적으로 복잡

### 🎯 결론
- **합주 모드**는 self-signed 인증서를 이용한 로컬 WSS 구조로 해결
- **파일 업로드**는 클라우드 기반 구조로 보안성과 UX 모두 확보

