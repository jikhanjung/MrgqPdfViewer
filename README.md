# 🎵 MrgqPdfViewer

**v0.1.8** - Android TV용 PDF 악보 리더 앱 (아키텍처 리팩토링 & 보안 강화)

## 📖 소개

Android TV OS에서 PDF 악보를 편리하게 보기 위한 전용 앱입니다. 혁신적인 UI와 직관적인 탐색으로 리모컨만으로 완벽한 PDF 읽기 경험을 제공하며, **실시간 협업 모드**로 여러 기기 간 페이지 동기화가 가능합니다.

## ✨ 주요 기능

### 📂 스마트 파일 관리
- 🗂️ **파일 탐색**: TV 화면에서 PDF 파일 목록 표시
- 🔤 **정렬 기능**: 이름순/시간순 정렬 지원
- 📊 **상세 정보**: 파일 크기, 수정 시간 표시
- 🗑️ **삭제 기능**: 개별 파일 삭제 (확인 대화상자 포함)

### 🌐 웹 업로드 시스템
- 📤 **무선 업로드**: 브라우저를 통한 간편한 파일 업로드
- 📊 **진행률 표시**: 실시간 업로드 진행 상황 표시
- 📋 **파일 관리**: 웹에서 파일 목록 조회 및 삭제
- 💬 **하단 메시지**: 업로드 결과를 화면 하단 전체폭으로 표시
- ⏰ **자동 숨김**: 5초 후 자동으로 메시지 사라짐

### 📄 혁신적인 PDF 뷰어
- 🖼️ **고해상도 렌더링**: 2-4배 스케일링으로 선명한 이미지 PDF
- 📖 **두 페이지 모드**: 가로 화면에서 세로 PDF를 두 페이지로 표시
- 💾 **설정 기억**: 파일별 페이지 모드 설정 자동 저장
- 🎯 **좌우 분할 탐색**: 직관적인 카드형 파일 이동 인터페이스
- ➡️ **큰 화살표**: 48dp 크기의 방향성 화살표 아이콘
- 📖 **파일 미리보기**: 이동할 파일명을 미리 확인
- 🎮 **리모컨 완벽 지원**: DPAD 및 ENTER 키로 완전한 조작
- ⚡ **즉시 페이지 전환**: 프리렌더링 캐시로 지연 없는 페이지 이동

### 🎼 실시간 협업 모드
- 🎯 **지휘자 모드**: 여러 연주자 기기의 페이지를 제어
- 🎵 **연주자 모드**: 지휘자의 페이지 변경에 자동 동기화
- 🔍 **자동 발견**: 네트워크에서 지휘자 기기 자동 찾기
- 📤 **파일 공유**: 지휘자가 파일을 선택하면 연주자에게 자동 전송
- 🔗 **안정적 연결**: 포트 충돌 방지 및 강제 종료 후 즉시 재연결
- 🌐 **전역 동기화**: 연주자가 어느 화면에 있든 즉시 반응

### ⚙️ TV 최적화 설정
- 📱 **TV 스타일 UI**: 카테고리별 메뉴로 리모컨 탐색 최적화
- 🎯 **직관적 아이콘**: 이모지 아이콘으로 설정 기능 즉시 식별
- 📊 **상세 패널**: 단계별 설정으로 복잡성 제거
- 🎮 **포커스 최적화**: 72dp 최소 터치 영역으로 리모컨 조작 용이

## 🚀 사용 방법

### 📱 파일 관리
1. **파일 목록**: 앱 실행 후 리모컨으로 PDF 파일 선택
2. **정렬**: 상단의 "이름순"/"시간순" 버튼으로 정렬 방식 변경
3. **삭제**: 각 파일의 "삭제" 버튼으로 개별 파일 제거
4. **설정**: 우상단 "설정" 버튼으로 고급 설정 접근

### 🌐 파일 업로드
1. **웹 서버 시작**: 메인 화면에서 웹 서버 토글 ON
2. **브라우저 접속**: `http://<TV IP>:포트번호` 접속 (기본 8080)
3. **파일 업로드**: 드래그 앤 드롭 또는 파일 선택으로 업로드
4. **파일 관리**: 웹에서 파일 목록 조회 및 개별/전체 삭제

### 📄 PDF 열람
1. **페이지 이동**: 리모컨 좌/우 버튼으로 페이지 이동
2. **두 페이지 모드**: 첫 실행 시 화면 비율에 따라 모드 선택 대화상자
3. **파일 간 탐색**: 마지막/첫 페이지에서 좌우 분할 카드로 파일 간 이동
4. **목록 복귀**: BACK 키 또는 탐색 카드의 "파일 목록" 선택

### 🎼 협업 모드
1. **지휘자 설정**: 설정 화면에서 "지휘자 모드" 활성화
2. **연주자 연결**: 다른 기기에서 "연주자 모드" → "자동 발견" 또는 직접 IP 입력
3. **실시간 동기화**: 지휘자가 페이지/파일을 변경하면 모든 연주자 즉시 동기화
4. **파일 공유**: 연주자에게 없는 파일은 자동 다운로드 제안

## 🛠️ 기술 스택

- **Android TV OS 11** 지원 (API 21-30)
- **Kotlin** 개발
- **PdfRenderer** 내장 PDF 렌더링
- **WebSocket** 실시간 협업 통신
- **NanoHTTPD** HTTP 서버
- **UDP 브로드캐스트** 자동 기기 발견
- **Material Design** TV 최적화 UI

## 📁 지원 디렉토리

```
/storage/emulated/0/Download/
├── 악보1.pdf
├── 악보2.pdf
└── 악보3.pdf
```

## 🔧 개발 환경

- Android Studio
- Android 5.0+ (API 21+)
- Android TV 지원 기기

## 📱 화면 구성

### 🏠 메인 화면
- **파일 목록**: 정렬 가능한 PDF 파일 리스트
- **파일 정보**: 크기, 수정시간 표시
- **정렬 버튼**: 이름순/시간순 토글
- **삭제 버튼**: 개별 파일 제거
- **설정 버튼**: 고급 설정 접근
- **웹 서버 토글**: 업로드 모드 활성화

### 📄 뷰어 화면  
- **전체 화면 PDF**: 몰입형 읽기 경험 (고해상도)
- **두 페이지 모드**: 세로 PDF를 두 페이지로 나란히 표시
- **페이지 정보**: 하단 중앙의 작은 표시
- **좌우 분할 탐색**: 파일 간 이동 카드 UI

### ⚙️ 설정 화면
**기존 설정 화면:**
- **웹서버 포트**: 1024-65535 범위 설정
- **파일별 설정**: 페이지 모드 개별 관리
- **설정 초기화**: 전체/선택적 초기화
- **파일 관리**: PDF 파일 전체 삭제

**새로운 TV 스타일 설정 화면:**
- **📂 파일 관리**: PDF 개수 확인, 전체 삭제, 파일별 설정 관리
- **🌐 웹서버 설정**: 포트 번호 변경, 서버 상태 확인
- **🎼 협업 모드**: 지휘자/연주자 모드 전환, 연결 설정, 자동 발견
- **🔧 시스템 설정**: 설정 초기화, 캐시 관리
- **📊 정보**: 앱 버전, 연결 상태, 디버그 정보

### 🌐 웹 업로드 인터페이스
- **모던 웹 UI**: 드래그 앤 드롭 지원
- **진행률 표시**: 실시간 업로드 진행상황
- **파일 목록**: 업로드된 파일 실시간 표시
- **파일 관리**: 개별/전체 파일 삭제
- **하단 메시지**: 성공/실패 알림

## 🎯 향후 계획

- 음성 인식 페이지 넘기기
- 박수 소리 감지 기능
- 북마크 시스템
- 메타데이터 관리
- 줌 인/아웃 기능
- 마지막 읽은 페이지 기억 기능

## 🔄 최근 업데이트 (v0.1.8)

### 🐛 페이지 설정 프리셋 버튼 수정
- **프리셋 버튼 미작동 문제 해결**: "초기화", "위/아래 5%" 등 페이지 설정 프리셋 버튼이 작동하지 않던 문제 수정
- **즉시 적용**: 프리셋 버튼 클릭 시 슬라이더 변경과 함께 실시간 미리보기 적용

### 🏗️ PdfViewerActivity 아키텍처 대규모 리팩토링
- **모놀리식 클래스 분해**: 600+ 라인의 복잡한 Activity를 4개의 전문 매니저 클래스로 분리
- **새로운 매니저 시스템**: PdfPageManager, ViewerInputHandler, ViewerCollaborationManager, ViewerFileManager
- **단일 책임 원칙**: 각 매니저가 특정 기능만 담당하여 유지보수성 대폭 향상
- **테스트 가능성**: 개별 컴포넌트 단위 테스트 가능한 구조

### 🔒 WSS 보안 강화 구현
- **WebSocket Secure**: 합주 모드 실시간 통신에 TLS 1.2/1.3 암호화 적용
- **인증서 피닝**: 자체 서명 인증서를 통한 중간자 공격 방지
- **네트워크 보안 정책**: Android 네트워크 보안 구성으로 강화된 보안
- **우아한 폴백**: SSL 설정 실패 시 기존 WS 프로토콜로 자동 전환

### 📊 코드 품질 향상
- **900+ 라인 재구성**: 복잡한 로직을 깔끔한 인터페이스와 리스너 패턴으로 구조화
- **매니저 패턴**: 관심사 분리를 통한 코드 가독성 및 확장성 증대
- **개발 문서화**: 상세한 개발 로그와 기술 문서 작성

---

**Z18TV Pro 전용 최적화된 PDF 악보 리더**