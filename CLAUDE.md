# MrgqPdfViewer 프로젝트 가이드

## 프로젝트 개요
Android TV OS (Z18TV Pro)용 PDF 악보 리더 앱으로, 무선 파일 업로드와 리모컨을 이용한 탐색 기능을 제공합니다.

**현재 버전**: v0.1.4 (2025-07-06)  
**빌드 상태**: 🟢 빌드 가능  
**테스트 상태**: 🟢 기본 기능 테스트 완료

## 주요 기능
- **파일 목록 뷰어**: `/sdcard/Download/` 디렉토리의 PDF 파일 목록 표시
- **정렬 및 관리**: 이름순/시간순 정렬, 개별 파일 삭제 기능
- **상세 파일 정보**: 파일 크기, 수정 시간 표시
- **설정 화면**: 웹서버 포트 설정, 파일별 페이지 모드 관리, PDF 파일 전체 삭제
- **웹 서버 업로드**: 설정 가능한 포트의 HTTP 서버를 통한 브라우저 기반 무선 파일 업로드  
- **업로드 진행률**: 실시간 업로드 진행률 표시 및 상태 메시지
- **웹 파일 관리**: 브라우저에서 파일 목록 조회, 개별/전체 삭제 기능
- **PDF 뷰어**: Android PdfRenderer를 이용한 고해상도 PDF 렌더링
- **두 페이지 모드**: 가로 화면에서 세로 PDF를 두 페이지로 표시하는 스마트 모드
- **파일별 설정 기억**: 각 PDF 파일의 페이지 모드 설정을 개별 저장
- **혁신적인 파일 탐색**: 좌우 분할 카드 UI로 직관적인 파일 간 이동
- **리모컨 탐색**: DPAD 및 ENTER 키 완벽 지원
- **TV 최적화**: Android TV UI 가이드라인 준수

## 기술 스택
- **플랫폼**: Android TV OS (minSdk 21, targetSdk 30)
- **언어**: Kotlin
- **PDF 렌더링**: PdfRenderer (Android 5.0+ 내장)
- **웹 서버**: NanoHTTPD 2.3.1
- **입력 처리**: 리모컨용 KeyEvent 처리
- **비동기**: Kotlin Coroutines

## 디렉토리 구조
```
/storage/emulated/0/Download/
├── 악보1.pdf
├── 악보2.pdf
└── 악보3.pdf
```

## 필요한 권한
- `READ_EXTERNAL_STORAGE`, `WRITE_EXTERNAL_STORAGE` (API 28 이하)
- `MANAGE_EXTERNAL_STORAGE` 또는 scoped storage (API 29+)
- `INTERNET`, `ACCESS_NETWORK_STATE` (웹 서버 기능용)

## 핵심 컴포넌트

### 1. PDF 파일 목록
- PDF 파일만 필터링하여 표시
- 파일명 정렬 (A-Z)
- 썸네일 없는 단순 리스트 뷰
- 리모컨 탐색 (DPAD_UP/DOWN, ENTER)

### 2. 웹 서버
- 기본 포트: 8080
- HTML 업로드 폼 (단일/다중 파일 지원)
- 업로드 후 자동 파일 저장
- ON/OFF 토글 기능

### 3. PDF 뷰어
- 한 번에 한 페이지 표시
- 고정 배율 또는 화면 맞춤 비율
- 리모컨으로 페이지 이동 (LEFT/RIGHT)
- 선택적 페이지 번호 표시

## 리모컨 키 매핑
- **DPAD_UP/DOWN**: 파일 목록 탐색
- **DPAD_LEFT/RIGHT**: PDF 뷰어에서 이전/다음 페이지
- **ENTER**: 파일 선택 또는 동작 확인

## 개발 가이드라인
- Android SDK 네이티브 컴포넌트 사용
- 파일 작업용 적절한 에러 처리 구현
- TV 하드웨어에서 원활한 성능 보장
- Android TV UI 가이드라인 준수
- 리모컨 입력으로 철저한 테스트

## 개발 환경

### 개발 워크플로우
- **코딩**: WSL2의 Claude Code에서 소스 코드 편집
- **빌드/테스트**: Windows 11의 Android Studio에서 실행
- **디버깅**: Windows 11에서 로그 확인 및 에뮬레이터/실기기 테스트

### 빌드 명령어 (Windows 11에서 실행)
```bash
# Debug 빌드
./gradlew assembleDebug

# Release 빌드  
./gradlew assembleRelease

# 앱 설치 (ADB 연결된 상태)
adb install app/build/outputs/apk/debug/app-debug.apk
```

### 테스트 항목
기능 구현 시 다음 항목들을 테스트하세요:
- 파일 목록 기능 (PDF 파일 인식 및 표시)
- PDF 렌더링 성능 (다양한 크기 파일)
- 웹 서버 업로드/다운로드 (브라우저 테스트)
- 리모컨 반응성 (모든 키 입력)
- 저장소 권한 처리 (Android 11+ 포함)

## 프로젝트 파일 구조

### 핵심 파일
- `MainActivity.kt`: 메인 화면 및 파일 목록
- `PdfViewerActivity.kt`: PDF 뷰어 화면 (고해상도 렌더링, 두 페이지 모드)
- `SettingsActivity.kt`: 설정 화면 (포트 설정, 파일 관리, 설정 초기화)
- `WebServerManager.kt`: HTTP 서버 관리 (업로드 진행률, 파일 관리 API)
- `PdfFileAdapter.kt`: 파일 목록 어댑터

### 리소스 파일
- `activity_settings.xml`: 설정 화면 레이아웃 (웹서버, PDF 관리, 파일별 설정)
- `colors.xml`: TV 최적화 색상 팔레트
- `themes.xml`: TV 전용 테마
- `dimens.xml`: TV 화면 크기 고려 치수
- `strings.xml`: 다국어 지원 텍스트

## 현재 구현 상태

### ✅ 완료된 기능
- [x] 프로젝트 초기 설정 및 구조
- [x] MainActivity 파일 목록 표시
- [x] 파일 정렬 기능 (이름순/시간순)
- [x] 파일 삭제 기능 및 확인 대화상자
- [x] 상세 파일 정보 표시 (크기, 수정시간)
- [x] 설정 화면 완전 구현 (SettingsActivity)
- [x] 웹서버 포트 설정 기능 (1024-65535 범위)
- [x] 파일별 페이지 모드 설정 관리
- [x] 설정 초기화 기능 (전체/선택적)
- [x] PDF 파일 전체 삭제 기능 (앱 내)
- [x] PdfViewerActivity 고해상도 PDF 렌더링
- [x] 두 페이지 모드 (landscape + portrait PDF)
- [x] 파일별 설정 저장 및 불러오기
- [x] 사용자 선택 기억 기능 (체크박스)
- [x] 혁신적인 파일 탐색 UI (좌우 분할 카드)
- [x] 큰 화살표 아이콘과 직관적인 안내
- [x] WebServerManager 고급 파일 업로드
- [x] 업로드 진행률 표시 (XMLHttpRequest)
- [x] 웹 인터페이스 파일 관리 (목록/삭제)
- [x] 파일 순서 정렬 문제 해결 (10+ 파일)
- [x] Base64 파일명 인코딩 (한글 지원)
- [x] 하단 전체폭 메시지 시스템
- [x] 리모컨 입력 처리
- [x] TV UI 최적화 및 페이지 정보 조정
- [x] 권한 처리 (Android TV OS 11 지원)
- [x] Release APK 빌드 설정 (서명/네이밍)
- [x] 새로운 MRGQ 브랜딩 아이콘
- [x] 빌드 설정 완료
- [x] 파일 간 탐색 기능 (다음/이전 파일)
- [x] 키 입력 기반 탐색 인터페이스
- [x] PDF 렌더링 디버깅 및 안정성 개선
- [x] UI 메시지 최적화 (불필요한 토스트 제거)
- [x] 파일 인덱스 일치 문제 해결

### 🟢 테스트 완료
- [x] 파일 목록 표시 및 탐색
- [x] 파일 정렬 기능 (이름순/시간순)
- [x] 파일 삭제 기능
- [x] 설정 화면 모든 기능 (포트 설정, 파일 관리, 설정 초기화)
- [x] PDF 파일 전체 삭제 (앱 내)
- [x] PDF 렌더링 기본 기능
- [x] 고해상도 PDF 렌더링 (2-4x 스케일링)
- [x] 두 페이지 모드 (가로/세로 비율 자동 판단)
- [x] 파일별 설정 저장/불러오기
- [x] 웹서버 파일 업로드 (진행률 표시)
- [x] 웹 인터페이스 파일 관리 (목록/삭제)
- [x] 파일 순서 정렬 (10+ 파일)
- [x] 파일 간 탐색 (다음/이전)
- [x] 파일 인덱스 일치 문제 해결
- [x] 새로운 탐색 UI (좌우 분할 카드)
- [x] 키 입력 기반 UI 탐색
- [x] Release APK 빌드 및 서명
- [x] 권한 처리 안정성 테스트

### 🟡 추가 테스트 필요
- [ ] 실제 TV 기기에서 설정 화면 동작 확인
- [ ] 두 페이지 모드 다양한 PDF 테스트
- [ ] 웹 업로드 대용량 파일 안정성 테스트
- [ ] 메모리 사용량 최적화 확인
- [ ] 장시간 사용 안정성 테스트

## v0.1.4 주요 업데이트 내용

### 새로운 기능
1. **설정 화면 추가 (SettingsActivity)**
   - 웹서버 포트 설정 (1024-65535 범위)
   - 파일별 페이지 모드 설정 관리
   - 전체/선택적 설정 초기화
   - PDF 파일 전체 삭제 기능

2. **두 페이지 모드**
   - 가로 화면에서 세로 PDF 자동 감지
   - 사용자 선택 기억 기능 (체크박스)
   - 파일별 개별 설정 저장

3. **고해상도 PDF 렌더링**
   - 2-4배 스케일링으로 선명한 이미지
   - 이미지 PDF 품질 대폭 개선

4. **웹 인터페이스 고도화**
   - 실시간 업로드 진행률 표시
   - 파일 목록 조회 및 관리
   - 개별/전체 파일 삭제 기능
   - 10개 이상 파일 순서 정렬 문제 해결

### 버그 수정
- 파일 인덱스 불일치 문제 해결 (클릭한 파일과 다른 파일 열림)
- PDF 페이지 이미 닫힘 예외 처리
- Base64 파일명 인코딩으로 한글 지원

### 기술적 개선
- Release APK 빌드 설정 및 서명
- 사용자 경험 개선 (불필요한 토스트 제거)
- 메모리 관리 최적화

## 향후 확장 가능성 (2-3단계)
- 북마크/즐겨찾기 시스템
- 마지막 읽은 페이지 기억 기능
- PDF 썸네일 또는 첫 페이지 미리보기
- 줌 인/아웃 기능
- 음성 인식으로 페이지 넘기기
- 박수나 소리 감지 기반 탐색
- JSON 기반 메타데이터 관리