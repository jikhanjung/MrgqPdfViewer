# MrgqPdfViewer - 제품 요구사항 문서 (PRD) - 수정본

**버전:** 2.0 (Android TV 특화)
**작성일:** 2025-07-28
**수정일:** 2025-07-28

---

## 1. 개요 (Overview)

MrgqPdfViewer는 Android TV 환경에서 음악가, 교육자, 발표자 등을 위해 설계된 고성능 PDF 뷰어 애플리케이션이다. 핵심 기능인 **앙상블 모드(Ensemble Mode)**는 '지휘자(Conductor)'가 제어하는 PDF 문서를 여러 '연주자(Performer)'의 기기에서 실시간으로 동기화하여, 악보, 강의 자료, 프레젠테이션 등을 원활하게 공유하고 함께 볼 수 있는 협업 환경을 제공한다.

**플랫폼 특화**: Android TV OS 환경에 최적화되어 리모컨 기반 조작과 TV 스크린에서의 가독성을 극대화한다.

## 2. 목표 (Goals and Objectives)

- **실시간 페이지 동기화:** 지휘자가 넘기는 페이지를 모든 연주자의 화면에 500ms 미만의 지연 시간으로 동기화하여 끊김 없는 사용자 경험을 제공한다.
- **안정적인 파일 공유:** 로컬 네트워크 내에서 안정적으로 PDF 파일을 공유하고, 다수의 사용자가 동시에 접속하여도 성능 저하 없이 파일을 다운로드할 수 있도록 한다.
- **TV 환경 최적화된 UI/UX:** 복잡한 설정 없이 누구나 쉽게 리모컨으로 지휘자가 되어 세션을 시작하고, 연주자가 되어 세션에 참여할 수 있는 TV 특화 인터페이스를 제공한다.
- **견고한 안정성:** 동적인 파일 목록 변경, 잦은 정렬 순서 변경, 다수 사용자 접속 등 다양한 시나리오에서도 앱이 비정상 종료되거나 오작동하지 않는 높은 안정성을 확보한다.
- **즉시 응답성:** 페이지 프리렌더링과 캐싱 시스템을 통해 즉각적인 페이지 전환을 보장한다.

## 3. 대상 사용자 (Target Audience)

- **지휘자 (Conductor):** 오케스트라, 밴드, 합창단의 지휘자. Android TV에서 앙상블 세션을 생성하고, 악보 PDF를 공유하며, 리모컨으로 페이지 넘김을 제어하는 주체.
- **연주자 (Performer):** 오케스트라 단원, 밴드 멤버, 합창단원. 각자의 Android TV에서 지휘자의 세션에 참여하여 동기화된 악보를 보며 연주에 집중하는 사용자.
- **교육자 및 학생:** TV 환경에서 강의 자료를 공유하고 함께 보며 수업을 진행하는 교사와 학생.
- **발표자 및 청중:** 대형 스크린에서 프레젠테이션 자료를 공유하며 발표를 진행하는 발표자와 청중.

## 4. 핵심 기능 요구사항 (Features Requirements)

### 4.1. PDF 뷰어 기본 기능

- **고품질 렌더링:** PDF 문서를 2-4배 스케일링으로 선명하고 정확하게 렌더링한다.
- **리모컨 기반 탐색:** Android TV 리모컨의 좌우 방향키를 통해 페이지를 넘길 수 있다.
- **스마트 페이지 모드:** 
  - 한 페이지 보기 (SINGLE)
  - 두 페이지 보기 (DOUBLE) - 가로 화면에서 세로 PDF 자동 감지
  - 자동 모드 (AUTO) - PDF 형태에 따른 최적 모드 자동 선택
- **페이지 전환 애니메이션:** 350ms 슬라이드 애니메이션으로 실제 악보 페이지 넘기기 경험 구현
- **오디오 피드백:** SoundPool 기반 페이지 넘기기 효과음 재생 (`page_turn.wav`)
- **볼륨 조절:** 슬라이더를 통한 효과음 볼륨 조절
- **즉시 페이지 전환:** PageCache 시스템으로 프리렌더링된 페이지의 즉각적 표시
- **PDF 표시 옵션:** OK 버튼 길게 누르기(800ms)로 접근하는 고급 설정
  - 위/아래 클리핑 설정 (0-15%, 1% 단위)
  - 중앙 여백 설정 (0-15%, 1% 단위)
  - 프리셋: 초기화, 위/아래 5% 클리핑

### 4.2. 파일 관리

- **앱 전용 디렉토리:** `/Android/data/com.mrgq.pdfviewer/files/PDFs/` 디렉토리 사용으로 외부 저장소 권한 불필요
- **카드 기반 파일 목록:** 페이지 수, 파일 크기, 수정 날짜가 포함된 현대적 TV 스타일 UI
- **실시간 PDF 메타데이터:** 파일 열기 없이 페이지 수 실시간 계산 및 표시
- **파일 목록 정렬:** 
  - 이름순 정렬 (A-Z)
  - 시간순 정렬 (최신순)
  - 버튼 클릭으로 즉시 전환
- **웹 업로드 시스템:** 
  - 설정 가능한 포트의 HTTP 서버 (기본 8080)
  - PC 브라우저를 통한 무선 파일 업로드
  - 실시간 업로드 진행률 표시
  - 파일 목록 조회 및 개별/전체 삭제 기능
  - 실시간 웹서버 모니터링 및 로그 추적
- **Race Condition 해결:** 파일 목록 변경 중에도 안전한 파일 열기 보장
- **파일 삭제:** 앱 내에서 불필요한 파일 삭제 기능

### 4.3. 앙상블 모드 (Ensemble Mode)

- **세션 생성 (지휘자):**
  - 지휘자는 공유할 PDF 파일을 선택하여 앙상블 모드 세션을 시작할 수 있다.
  - WebSocket 서버 (포트 9090) 자동 시작
  - UDP 브로드캐스트 (포트 9091)를 통한 세션 자동 알림
  - 소켓 타임아웃(1초) 적용으로 안정적인 포트 관리
- **세션 참여 (연주자):**
  - 자동 지휘자 발견 시스템 (15초 검색)
  - 발견된 지휘자 목록에서 원터치 연결
  - 수동 IP 입력 폴백 옵션
  - 세션 참여 시 지휘자가 공유한 PDF 파일을 자동으로 다운로드
- **실시간 페이지 동기화:**
  - WebSocket 기반 실시간 통신
  - 지휘자 페이지 변경 시 모든 연주자에게 즉시 전송 (500ms 미만)
  - 파일 변경 시 자동 동기화 및 다운로드
  - 애니메이션 동기화 (연주자도 350ms 슬라이드 애니메이션 적용)
- **전역 상태 관리:** GlobalCollaborationManager를 통한 일관된 협업 상태 관리
- **자동 정리:** 앱 종료 시 모든 협업 리소스 완전 해제

### 4.4. TV 최적화 UI/UX

- **전문적인 스플래시 스크린:** 브랜딩 강화된 2.5초 애니메이션 시퀀스
- **리모컨 친화적 탐색:** DPAD 및 ENTER 키 완벽 지원
- **TV 스타일 설정 화면:**
  - 이모지 아이콘 카테고리 메뉴 (📂파일관리, 🌐웹서버, 🎼협업모드, 🔧시스템, 📊정보)
  - 72dp 최소 터치 영역으로 리모컨 조작 최적화
  - 상세 패널 방식의 단계별 설정 구조
- **다크 테마:** TV 환경에 최적화된 어두운 테마 기반 디자인
- **포커스 시각화:** 선택된 아이템의 명확한 포커스 표시 및 애니메이션
- **화면 꺼짐 방지:** 연주 중 화면보호기 비활성화 옵션

### 4.5. 데이터 관리

- **Room 데이터베이스:** SQLite 기반 PDF 메타데이터 및 사용자 설정 관리
- **DisplayMode 시스템:** AUTO/SINGLE/DOUBLE 표시 모드를 파일별로 개별 저장
- **사용자 설정 지속성:** 클리핑, 여백, 표시 모드 등 파일별 개별 설정 저장
- **데이터베이스 마이그레이션:** 버전 업그레이드 시 안전한 데이터 이전

### 4.6. 보안 (수정됨)

- **네트워크 통신:** 현재 WebSocket(WS) 및 HTTP 사용 (호환성 우선)
- **로컬 네트워크 제한:** 동일 네트워크 내에서만 접근 가능
- **앱 전용 디렉토리:** 시스템 보안 정책 준수, 외부 접근 차단
- **포트 보안:** 사용자 정의 가능한 포트로 기본 포트 회피

## 5. 비기능적 요구사항 (Non-Functional Requirements)

- **성능:** 
  - 페이지 렌더링: 캐시 히트 시 즉시 표시, 캐시 미스 시 500ms 이내
  - 앙상블 모드 동기화: 500ms 미만 지연
  - 페이지 전환 애니메이션: 350ms 일관된 속도
- **안정성:** 
  - Crash-Free User 비율 99.5% 이상 목표
  - Race condition 완전 제거
  - 메모리 누수 방지 (PageCache LRU 관리)
- **호환성:** 
  - Android TV OS 8.0 (API 26) 이상
  - Z18TV Pro 및 기타 Android TV 기기
- **사용성:** 
  - 모든 주요 기능은 리모컨으로 3번 이하의 조작으로 접근 가능
  - 직관적인 아이콘과 명확한 피드백
- **확장성:**
  - 50개 이상 PDF 파일 처리 가능
  - 다중 연주자 동시 접속 지원

## 6. 기술 스택 및 아키텍처

- **플랫폼:** Android TV OS (minSdk 26, targetSdk 30)
- **언어:** Kotlin
- **아키텍처:** Manager 패턴 기반 분산 아키텍처
- **PDF 렌더링:** Android PdfRenderer (Android 5.0+ 내장)
- **데이터베이스:** Room 2.6.1 (SQLite 기반)
- **웹 서버:** NanoHTTPD 2.3.1
- **실시간 통신:** WebSocket + UDP 브로드캐스트
- **비동기 처리:** Kotlin Coroutines
- **캐싱:** LruCache 기반 PageCache 시스템

## 7. 현재 구현 상태 (v0.1.10)

### ✅ 완료된 기능
- PDF 뷰어 기본 기능 (95%)
- 파일 관리 시스템 (100%)
- 앙상블 모드 (90%)
- TV 최적화 UI/UX (95%)
- 데이터 관리 (100%)
- 성능 최적화 (95%)

### 🚧 진행 중인 기능
- 합주 모드 메시지 큐 시스템 (설계 완료)
- 연주자 모드 화면 꺼짐 방지
- 지휘자 동기화 후 연주자 입력 무효화

### 📋 계획된 기능
- 실시간 마우스 포인터 및 하이라이트 공유
- WSS/HTTPS 보안 강화 (호환성 허용 시)

## 8. 향후 고려사항 (Out of Scope / Future Considerations)

### Phase 2 기능
- **주석(Annotation) 기능:** PDF 위에 필기, 하이라이트 등 주석을 추가하고 실시간 동기화
- **마우스 포인터 공유:** 지휘자의 마우스 움직임을 연주자 화면에 실시간 표시
- **보안 강화:** WSS + HTTPS 완전 암호화 (호환성 해결 시)
- **음성 인식:** 음성 명령으로 페이지 넘기기
- **박수 감지:** 소리 감지 기반 자동 페이지 넘기기

### Phase 3 기능
- **클라우드 연동:** Google Drive, Dropbox 등 클라우드 스토리지 연동
- **크로스 플랫폼:** 일반 Android, iOS, Web 확장
- **사용자 인증:** 세션별 비밀번호 및 권한 관리
- **북마크 시스템:** 자주 사용하는 페이지 북마크
- **마지막 읽은 페이지:** 파일별 독서 진행 상황 기억

## 9. 성공 지표 (Success Metrics)

- **기술적 지표:**
  - 페이지 전환 응답시간: < 100ms (캐시 히트)
  - 앙상블 동기화 지연: < 500ms
  - 앱 크래시율: < 0.5%
  - 메모리 사용량: < 500MB (대용량 PDF 포함)

- **사용자 경험 지표:**
  - 세션 연결 성공률: > 95%
  - 사용자 만족도: 4.5/5.0 이상
  - 기능 접근성: 모든 기능 3번 이하 조작

- **운영 지표:**
  - 파일 업로드 성공률: > 99%
  - 다중 사용자 동시 접속: 10명 이상 안정 지원

---

**변경 이력:**
- v1.0 (2025-07-28): 초기 작성
- v2.0 (2025-07-28): Android TV 특화로 전면 수정, 현재 구현 상태 반영